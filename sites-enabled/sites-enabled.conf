# ===========================================
# Default server - routes based on IP address
# ===========================================

# Map destination IP to backend
map $server_addr $backend_host {
    # poli-worker-01-a
    130.192.166.200  poli-worker-01-a;
    130.192.166.201  poli-worker-01-a;
    130.192.166.202  poli-worker-01-a;
    130.192.166.203  poli-worker-01-a;
    
    # poli-worker-01-b
    130.192.166.204  poli-worker-01-b;
    130.192.166.205  poli-worker-01-b;
    130.192.166.206  poli-worker-01-b;
    130.192.166.207  poli-worker-01-b;
    
    # poli-worker-01-c
    130.192.166.208  poli-worker-01-c;
    130.192.166.209  poli-worker-01-c;
    130.192.166.210  poli-worker-01-c;
    130.192.166.211  poli-worker-01-c;
    
    # poli-worker-01-d
    130.192.166.212  poli-worker-01-d;
    130.192.166.213  poli-worker-01-d;
    130.192.166.214  poli-worker-01-d;
    130.192.166.215  poli-worker-01-d;
    
    # Default fallback
    default          poli-worker-01-a;
}

# ===========================================
# HTTP server - ACME challenge and redirect
# ===========================================
server {
    listen 80;
    server_name www0.idrago.org www1.idrago.org www2.idrago.org www3.idrago.org;

    # ACME challenge location for Let's Encrypt
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}

# ===========================================
# Default HTTPS server
# ===========================================
server {
    listen 443 ssl default_server;
    server_name _;
    
    # Let's Encrypt certificate
    ssl_certificate /etc/letsencrypt/live/idrago.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/idrago.org/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    access_log /var/log/nginx/default-access.log detailed;
    error_log /var/log/nginx/default-error.log warn;
    
    location / {
        proxy_pass http://$backend_host;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Request-ID $request_id;
    }
}


# ===========================================
# bendingsponge.eu hosts
# ===========================================

# drupal.bendingsponge.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name drupal.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/drupal-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/drupal-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/drupal-error.log warn;

  location / {
    proxy_pass http://real-drupal;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ghost.bendingsponge.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name ghost.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/ghost-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/ghost-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/ghost-error.log warn;

  location / {
    proxy_pass http://real-ghost;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# gitlab.bendingsponge.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name gitlab.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/gitlab-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/gitlab-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/gitlab-error.log warn;

  location / {
    proxy_pass http://real-gitlab;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grafana.bendingsponge.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name grafana.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/grafana-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/grafana-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/grafana-error.log warn;

  location / {
    proxy_pass http://real-grafana;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grav.bendingsponge.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name grav.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/grav-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/grav-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/grav-error.log warn;

  location / {
    proxy_pass http://hp-grav;
    proxy_set_header Host grav.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# jenkins.bendingsponge.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name jenkins.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/jenkins-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/jenkins-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/jenkins-error.log warn;

  location / {
    proxy_pass http://hp-jenkins;
    proxy_set_header Host jenkins.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# metabase.bendingsponge.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name metabase.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/metabase-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/metabase-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/metabase-error.log warn;

  location / {
    proxy_pass http://hp-metabase;
    proxy_set_header Host metabase.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# phpmyadmin.bendingsponge.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name phpmyadmin.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/phpmyadmin-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/phpmyadmin-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/phpmyadmin-error.log warn;

  location / {
    proxy_pass http://hp-phpmyadmin;
    proxy_set_header Host phpmyadmin.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# wordpress.bendingsponge.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name wordpress.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/wordpress-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/wordpress-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/wordpress-error.log warn;

  location / {
    proxy_pass http://hp-wordpress;
    proxy_set_header Host wordpress.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www0.bendingsponge.eu (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www0.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/www0-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/www0-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/www0-error.log warn;

  location / {
    proxy_pass http://agent-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www1.bendingsponge.eu (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www1.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/www1-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/www1-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/www1-error.log warn;

  location / {
    proxy_pass http://dummy-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www2.bendingsponge.eu (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www2.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/www2-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/www2-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/www2-error.log warn;

  location / {
    proxy_pass http://agent-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www3.bendingsponge.eu (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www3.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/www3-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/www3-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/www3-error.log warn;

  location / {
    proxy_pass http://dummy-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# zabbix.bendingsponge.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name zabbix.bendingsponge.eu;

  access_log /var/log/nginx/bendingsponge.eu/zabbix-access.log detailed;
  access_log /var/log/nginx/bendingsponge.eu/zabbix-access.json.log json_detailed;
  error_log /var/log/nginx/bendingsponge.eu/zabbix-error.log warn;

  location / {
    proxy_pass http://real-zabbix;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ===========================================
# idrago.org hosts
# ===========================================

# drupal.idrago.org (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name drupal.idrago.org;

  access_log /var/log/nginx/idrago.org/drupal-access.log detailed;
  access_log /var/log/nginx/idrago.org/drupal-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/drupal-error.log warn;

  location / {
    proxy_pass http://hp-drupal;
    proxy_set_header Host drupal.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ghost.idrago.org (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name ghost.idrago.org;

  access_log /var/log/nginx/idrago.org/ghost-access.log detailed;
  access_log /var/log/nginx/idrago.org/ghost-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/ghost-error.log warn;

  location / {
    proxy_pass http://hp-ghost;
    proxy_set_header Host ghost.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# gitlab.idrago.org (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name gitlab.idrago.org;

  access_log /var/log/nginx/idrago.org/gitlab-access.log detailed;
  access_log /var/log/nginx/idrago.org/gitlab-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/gitlab-error.log warn;

  location / {
    proxy_pass http://hp-gitlab;
    proxy_set_header Host gitlab.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grafana.idrago.org (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name grafana.idrago.org;

  access_log /var/log/nginx/idrago.org/grafana-access.log detailed;
  access_log /var/log/nginx/idrago.org/grafana-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/grafana-error.log warn;

  location / {
    proxy_pass http://hp-grafana;
    proxy_set_header Host grafana.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grav.idrago.org (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name grav.idrago.org;

  access_log /var/log/nginx/idrago.org/grav-access.log detailed;
  access_log /var/log/nginx/idrago.org/grav-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/grav-error.log warn;

  location / {
    proxy_pass http://real-grav;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# jenkins.idrago.org (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name jenkins.idrago.org;

  access_log /var/log/nginx/idrago.org/jenkins-access.log detailed;
  access_log /var/log/nginx/idrago.org/jenkins-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/jenkins-error.log warn;

  location / {
    proxy_pass http://real-jenkins;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# metabase.idrago.org (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name metabase.idrago.org;

  access_log /var/log/nginx/idrago.org/metabase-access.log detailed;
  access_log /var/log/nginx/idrago.org/metabase-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/metabase-error.log warn;

  location / {
    proxy_pass http://real-metabase;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# phpmyadmin.idrago.org (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name phpmyadmin.idrago.org;

  access_log /var/log/nginx/idrago.org/phpmyadmin-access.log detailed;
  access_log /var/log/nginx/idrago.org/phpmyadmin-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/phpmyadmin-error.log warn;

  location / {
    proxy_pass http://real-phpmyadmin;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# wordpress.idrago.org (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name wordpress.idrago.org;

  access_log /var/log/nginx/idrago.org/wordpress-access.log detailed;
  access_log /var/log/nginx/idrago.org/wordpress-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/wordpress-error.log warn;

  location / {
    proxy_pass http://real-wordpress;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www0.idrago.org (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www0.idrago.org;

  access_log /var/log/nginx/idrago.org/www0-access.log detailed;
  access_log /var/log/nginx/idrago.org/www0-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/www0-error.log warn;

  location / {
    proxy_pass http://agent-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www1.idrago.org (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www1.idrago.org;

  access_log /var/log/nginx/idrago.org/www1-access.log detailed;
  access_log /var/log/nginx/idrago.org/www1-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/www1-error.log warn;

  location / {
    proxy_pass http://dummy-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www2.idrago.org (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www2.idrago.org;

  access_log /var/log/nginx/idrago.org/www2-access.log detailed;
  access_log /var/log/nginx/idrago.org/www2-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/www2-error.log warn;

  location / {
    proxy_pass http://agent-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www3.idrago.org (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www3.idrago.org;

  access_log /var/log/nginx/idrago.org/www3-access.log detailed;
  access_log /var/log/nginx/idrago.org/www3-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/www3-error.log warn;

  location / {
    proxy_pass http://dummy-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# zabbix.idrago.org (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name zabbix.idrago.org;

  access_log /var/log/nginx/idrago.org/zabbix-access.log detailed;
  access_log /var/log/nginx/idrago.org/zabbix-access.json.log json_detailed;
  error_log /var/log/nginx/idrago.org/zabbix-error.log warn;

  location / {
    proxy_pass http://hp-zabbix;
    proxy_set_header Host zabbix.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ===========================================
# inginf.units.it hosts
# ===========================================

# drupal.inginf.units.it (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name drupal.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/drupal-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/drupal-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/drupal-error.log warn;

  location / {
    proxy_pass http://real-drupal;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ghost.inginf.units.it (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name ghost.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/ghost-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/ghost-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/ghost-error.log warn;

  location / {
    proxy_pass http://real-ghost;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# gitlab.inginf.units.it (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name gitlab.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/gitlab-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/gitlab-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/gitlab-error.log warn;

  location / {
    proxy_pass http://real-gitlab;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grafana.inginf.units.it (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name grafana.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/grafana-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/grafana-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/grafana-error.log warn;

  location / {
    proxy_pass http://real-grafana;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grav.inginf.units.it (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name grav.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/grav-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/grav-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/grav-error.log warn;

  location / {
    proxy_pass http://hp-grav;
    proxy_set_header Host grav.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# jenkins.inginf.units.it (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name jenkins.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/jenkins-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/jenkins-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/jenkins-error.log warn;

  location / {
    proxy_pass http://hp-jenkins;
    proxy_set_header Host jenkins.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# metabase.inginf.units.it (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name metabase.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/metabase-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/metabase-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/metabase-error.log warn;

  location / {
    proxy_pass http://hp-metabase;
    proxy_set_header Host metabase.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# phpmyadmin.inginf.units.it (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name phpmyadmin.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/phpmyadmin-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/phpmyadmin-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/phpmyadmin-error.log warn;

  location / {
    proxy_pass http://hp-phpmyadmin;
    proxy_set_header Host phpmyadmin.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# wordpress.inginf.units.it (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name wordpress.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/wordpress-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/wordpress-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/wordpress-error.log warn;

  location / {
    proxy_pass http://hp-wordpress;
    proxy_set_header Host wordpress.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www0.inginf.units.it (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www0.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/www0-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/www0-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/www0-error.log warn;

  location / {
    proxy_pass http://agent-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www1.inginf.units.it (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www1.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/www1-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/www1-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/www1-error.log warn;

  location / {
    proxy_pass http://dummy-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www2.inginf.units.it (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www2.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/www2-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/www2-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/www2-error.log warn;

  location / {
    proxy_pass http://agent-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www3.inginf.units.it (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www3.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/www3-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/www3-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/www3-error.log warn;

  location / {
    proxy_pass http://dummy-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# zabbix.inginf.units.it (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name zabbix.inginf.units.it;

  access_log /var/log/nginx/inginf.units.it/zabbix-access.log detailed;
  access_log /var/log/nginx/inginf.units.it/zabbix-access.json.log json_detailed;
  error_log /var/log/nginx/inginf.units.it/zabbix-error.log warn;

  location / {
    proxy_pass http://real-zabbix;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ===========================================
# pimcity-h2020.eu hosts
# ===========================================

# drupal.pimcity-h2020.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name drupal.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/drupal-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/drupal-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/drupal-error.log warn;

  location / {
    proxy_pass http://hp-drupal;
    proxy_set_header Host drupal.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# ghost.pimcity-h2020.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name ghost.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/ghost-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/ghost-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/ghost-error.log warn;

  location / {
    proxy_pass http://hp-ghost;
    proxy_set_header Host ghost.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# gitlab.pimcity-h2020.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name gitlab.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/gitlab-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/gitlab-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/gitlab-error.log warn;

  location / {
    proxy_pass http://hp-gitlab;
    proxy_set_header Host gitlab.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grafana.pimcity-h2020.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name grafana.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/grafana-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/grafana-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/grafana-error.log warn;

  location / {
    proxy_pass http://hp-grafana;
    proxy_set_header Host grafana.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# grav.pimcity-h2020.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name grav.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/grav-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/grav-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/grav-error.log warn;

  location / {
    proxy_pass http://real-grav;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# jenkins.pimcity-h2020.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name jenkins.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/jenkins-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/jenkins-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/jenkins-error.log warn;

  location / {
    proxy_pass http://real-jenkins;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# metabase.pimcity-h2020.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name metabase.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/metabase-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/metabase-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/metabase-error.log warn;

  location / {
    proxy_pass http://real-metabase;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# phpmyadmin.pimcity-h2020.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name phpmyadmin.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/phpmyadmin-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/phpmyadmin-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/phpmyadmin-error.log warn;

  location / {
    proxy_pass http://real-phpmyadmin;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# wordpress.pimcity-h2020.eu (real) -> poli-worker-01-c
server {
  listen 443 ssl;
  server_name wordpress.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/wordpress-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/wordpress-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/wordpress-error.log warn;

  location / {
    proxy_pass http://real-wordpress;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www0.pimcity-h2020.eu (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www0.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/www0-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/www0-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/www0-error.log warn;

  location / {
    proxy_pass http://agent-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www1.pimcity-h2020.eu (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www1.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/www1-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/www1-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/www1-error.log warn;

  location / {
    proxy_pass http://dummy-1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www2.pimcity-h2020.eu (agent) -> poli-worker-01-a
server {
  listen 443 ssl;
  server_name www2.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/www2-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/www2-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/www2-error.log warn;

  location / {
    proxy_pass http://agent-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# www3.pimcity-h2020.eu (dummy) -> poli-worker-01-b
server {
  listen 443 ssl;
  server_name www3.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/www3-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/www3-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/www3-error.log warn;

  location / {
    proxy_pass http://dummy-2;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}

# zabbix.pimcity-h2020.eu (hp) -> poli-worker-01-d
server {
  listen 443 ssl;
  server_name zabbix.pimcity-h2020.eu;

  access_log /var/log/nginx/pimcity-h2020.eu/zabbix-access.log detailed;
  access_log /var/log/nginx/pimcity-h2020.eu/zabbix-access.json.log json_detailed;
  error_log /var/log/nginx/pimcity-h2020.eu/zabbix-error.log warn;

  location / {
    proxy_pass http://hp-zabbix;
    proxy_set_header Host zabbix.local;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Request-ID $request_id;
    }
}
